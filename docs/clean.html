<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for babies - 4&nbsp; Làm sạch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analysis.html" rel="next">
<link href="./r_basics.html" rel="prev">
<link href="./logo-icon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-RDC0B0FCNZ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RDC0B0FCNZ', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Làm sạch</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for babies</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Tổng quan</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Giới thiệu</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prepare.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chuẩn bị</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Nhập môn R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clean.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Làm sạch</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân tích</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Trực quan hóa</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./viz-practice.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Thực hành trực quan hóa</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./report.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Làm báo cáo bằng R Markdown</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-gọn-gàng-tidy-data" id="toc-data-gọn-gàng-tidy-data" class="nav-link active" data-scroll-target="#data-gọn-gàng-tidy-data"><span class="toc-section-number">4.1</span>  Data gọn gàng (tidy data)</a>
  <ul class="collapse">
  <li><a href="#format-bảng" id="toc-format-bảng" class="nav-link" data-scroll-target="#format-bảng"><span class="toc-section-number">4.1.1</span>  Format bảng</a></li>
  <li><a href="#tên-cột" id="toc-tên-cột" class="nav-link" data-scroll-target="#tên-cột"><span class="toc-section-number">4.1.2</span>  Tên cột</a></li>
  </ul></li>
  <li><a href="#kết-hợp-dữ-liệu" id="toc-kết-hợp-dữ-liệu" class="nav-link" data-scroll-target="#kết-hợp-dữ-liệu"><span class="toc-section-number">4.2</span>  Kết hợp dữ liệu</a></li>
  <li><a href="#xử-lý-các-dữ-liệu-lỗi" id="toc-xử-lý-các-dữ-liệu-lỗi" class="nav-link" data-scroll-target="#xử-lý-các-dữ-liệu-lỗi"><span class="toc-section-number">4.3</span>  Xử lý các dữ liệu lỗi</a>
  <ul class="collapse">
  <li><a href="#kiểm-tra-giá-trị" id="toc-kiểm-tra-giá-trị" class="nav-link" data-scroll-target="#kiểm-tra-giá-trị"><span class="toc-section-number">4.3.1</span>  Kiểm tra giá trị</a></li>
  <li><a href="#xử-lý-dữ-liệu" id="toc-xử-lý-dữ-liệu" class="nav-link" data-scroll-target="#xử-lý-dữ-liệu"><span class="toc-section-number">4.3.2</span>  Xử lý dữ liệu</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Làm sạch</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Bước đầu tiên sau khi đọc được dữ liệu vào R là “làm sạch” dữ liệu (clean data). Chúng ta chỉ tiến hành phân tích khi chắc chắn dữ liệu đã “sạch” và chính xác.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Mục tiêu
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Hiểu khái niệm dữ liệu gọn gàng</p></li>
<li><p>Hiểu cách sử dụng các lệnh join</p></li>
<li><p>Học các cách xử lý dữ liệu lỗi</p></li>
</ol>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Các package được sử dụng trong bài học
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>readxl</p></li>
<li><p>janitor</p></li>
<li><p>tidyverse</p></li>
</ul>
</div>
</div>
<section id="data-gọn-gàng-tidy-data" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="data-gọn-gàng-tidy-data"><span class="header-section-number">4.1</span> Data gọn gàng (tidy data)</h2>
<p>Dữ liệu gọn gàng có các đặc điểm sau:<span class="citation" data-cites="wickham2014"><sup><a href="references.html#ref-wickham2014" role="doc-biblioref">1</a></sup></span></p>
<ul>
<li>Mỗi biến là một cột; mỗi cột là một biến</li>
<li>Mỗi quan sát là một hàng; mỗi hàng là một quan sát</li>
<li>Mỗi giá trị nằm trong một ô; mỗi ô chứa một giá trị duy nhất</li>
</ul>
<p>Chúng ta sẽ dùng data <code>gdp-capita.xlsx</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">"data/gdp-capita.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="format-bảng" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="format-bảng"><span class="header-section-number">4.1.1</span> Format bảng</h3>
<p>Bảng dữ liệu hiện tại chưa tuân theo quy tắc tidy data vì các cột 2015 - 2022 <strong>không phải là biến</strong> và <strong>mỗi hàng đang chứa nhiều quan sát</strong> (quan sát cho các năm từ 2015 - 2022).</p>
<p>Hiện tại bảng dữ liệu đang ở <code>định dạng ngang (wide)</code>, khi nhiều quan sát của cùng chủ thể (trong VD này là các quốc gia) được lưu trữ trong một hàng duy nhất. Điều này có thể hữu ích cho việc hiển thị, tuy nhiên không lý tưởng cho việc phân tích.</p>
<p>Để tuân theo quy tắc tidy data, ta cần format bảng dữ liệu sang <code>định dạng dọc (long)</code></p>
<p>Để format bảng dữ liệu trong R, ta có thể sử dụng các lệnh sau.</p>
<ul>
<li><p><code>pivot_longer()</code> - chuyển dữ liệu từ dạng ngang sang dọc.</p></li>
<li><p><code>pivot_wider()</code> - chuyển dữ liệu từ dạng dọc sang ngang.<br>
</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"2"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># đặt tên mới cho biến</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># đặt tên mới cho cột giá trị tương ứng</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"gdp"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  `Country Name` `Country Code` year     gdp
  &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;  &lt;dbl&gt;
1 Aruba          ABW            2015  28419.
2 Aruba          ABW            2016  28450.
3 Aruba          ABW            2017  29329.
4 Aruba          ABW            2018  30918.
5 Aruba          ABW            2019  31903.
6 Aruba          ABW            2020  24008.</code></pre>
</div>
</div>
</section>
<section id="tên-cột" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="tên-cột"><span class="header-section-number">4.1.2</span> Tên cột</h3>
<p>Trong R, tên cột là giá trị trên đỉnh của một cột.</p>
<p>Các quy tắc cho tên cột thường bao gồm:</p>
<ul>
<li><p>Tên ngắn</p></li>
<li><p>Không có khoảng trắng (thay thế bằng dấu gạch dưới _ ).</p></li>
<li><p>Không có ký tự đặc biệt (&amp;, #, &lt;, &gt;, …) hoặc dấu.</p></li>
<li><p>Không bắt đầu bằng số.</p></li>
</ul>
<p>Lệnh <code>clean_names()</code> của package <code>janitor</code> được sử dụng để tự động hoá quá trình chuẩn hoá tên cột. Ngoài ra, lệnh <code>rename()</code> của package <code>dplyr</code> được sử dụng để thay đổi tên cột một cách thủ công.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chuẩn hoá tên cột tự động</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="kết-hợp-dữ-liệu" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="kết-hợp-dữ-liệu"><span class="header-section-number">4.2</span> Kết hợp dữ liệu</h2>
<p>Trong nhiều trường hợp, dữ liệu bị chia thành nhiều bảng khác nhau và để phân tích thì chúng ta phải kết hợp các bảng lại.</p>
<p>Để nối 2 bảng với nhau trong R, ta sử dụng 1 trong các lệnh join của package <code>dplyr</code> sau đây</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Công dụng</th>
<th>GIF minh hoạ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>left_join()</td>
<td>Nối ngoài bên trái</td>
<td><img src="https://github.com/gadenbuie/tidyexplain/blob/main/images/left-join.gif?raw=true" class="img-fluid" width="283"></td>
</tr>
<tr class="even">
<td>right_join()</td>
<td>Nối ngoài bên phải</td>
<td><img src="https://github.com/gadenbuie/tidyexplain/blob/main/images/right-join.gif?raw=true" class="img-fluid" width="282"></td>
</tr>
<tr class="odd">
<td>inner_join()</td>
<td>Nối trong</td>
<td><img src="https://github.com/gadenbuie/tidyexplain/blob/main/images/inner-join.gif?raw=true" class="img-fluid" width="281"></td>
</tr>
<tr class="even">
<td>full_join()</td>
<td>Nối ngoài</td>
<td><img src="https://github.com/gadenbuie/tidyexplain/blob/main/images/full-join.gif?raw=true" class="img-fluid" width="281"></td>
</tr>
</tbody>
</table>
<p>Để sử dụng lệnh join, ta cần cung cấp cho R các thông tin sau:</p>
<ul>
<li><p>2 bảng cần nối</p></li>
<li><p>các cột chung để nối bằng lệnh <code>join_by</code> (R mặc định nối 2 bảng bằng cột có tên giống nhau)</p></li>
</ul>
<p><a href="https://github.com/gadenbuie/tidyexplain/tree/main">Tổng hợp các lệnh join cùng GIF minh hoạ</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">"data/gdp-capita.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Nối 2 bảng bằng lệnh left_join</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trong trường hợp này, tuy lệnh join_by không cần thiết nhưng có thể giúp cho code rõ ràng hơn </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(df, mt, <span class="at">by =</span> <span class="fu">join_by</span>(country_code <span class="sc">==</span> country_code))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,128 × 8
   country_name      country_code year     gdp region income_group special_notes
   &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;        
 1 Aruba             ABW          2015  28419. Latin… High income  &lt;NA&gt;         
 2 Aruba             ABW          2016  28450. Latin… High income  &lt;NA&gt;         
 3 Aruba             ABW          2017  29329. Latin… High income  &lt;NA&gt;         
 4 Aruba             ABW          2018  30918. Latin… High income  &lt;NA&gt;         
 5 Aruba             ABW          2019  31903. Latin… High income  &lt;NA&gt;         
 6 Aruba             ABW          2020  24008. Latin… High income  &lt;NA&gt;         
 7 Aruba             ABW          2021  29128. Latin… High income  &lt;NA&gt;         
 8 Aruba             ABW          2022  33301. Latin… High income  &lt;NA&gt;         
 9 Africa Eastern a… AFE          2015   1554. &lt;NA&gt;   &lt;NA&gt;         26 countries…
10 Africa Eastern a… AFE          2016   1444. &lt;NA&gt;   &lt;NA&gt;         26 countries…
# ℹ 2,118 more rows
# ℹ 1 more variable: table_name &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="xử-lý-các-dữ-liệu-lỗi" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="xử-lý-các-dữ-liệu-lỗi"><span class="header-section-number">4.3</span> Xử lý các dữ liệu lỗi</h2>
<section id="kiểm-tra-giá-trị" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="kiểm-tra-giá-trị"><span class="header-section-number">4.3.1</span> Kiểm tra giá trị</h3>
<p>Thường bao gồm các bước chính</p>
<ul>
<li><p>Kiểm tra datatype</p></li>
<li><p>Kiểm tra các giá trị NA</p></li>
<li><p>Kiểm tra các khoảng giá trị của từng cột</p></li>
</ul>
<section id="kiểm-tra-datatype" class="level4" data-number="4.3.1.1">
<h4 data-number="4.3.1.1" class="anchored" data-anchor-id="kiểm-tra-datatype"><span class="header-section-number">4.3.1.1</span> Kiểm tra datatype</h4>
<p>Khi đọc dữ liệu, R sẽ tự động đổi datatype của các cột sang dạng phù hợp nhất. Tuy nhiên, đôi lúc R sẽ chuyển thành datatype khác với mong muốn.</p>
<p>Một số trường hợp có thể xảy ra lỗi bao gồm:</p>
<ul>
<li><p>Cột số nhưng có 1 số hàng chứa chữ</p></li>
<li><p>Ngày theo format khác với format tiêu chuẩn của R (VD: <code>as.Date("01-01-2014")</code>)</p></li>
</ul>
</section>
<section id="kiểm-tra-na-khoảng-giá-trị-của-từng-cột" class="level4" data-number="4.3.1.2">
<h4 data-number="4.3.1.2" class="anchored" data-anchor-id="kiểm-tra-na-khoảng-giá-trị-của-từng-cột"><span class="header-section-number">4.3.1.2</span> Kiểm tra NA/ khoảng giá trị của từng cột</h4>
<p>Trong R có lệnh <code>summary</code> để người dùng có thể nhanh chóng kiểm tra các khoảng giá trị và số dữ liệu NA trong từng cột.</p>
<p>Ngoài ra, tuỳ vào bộ dữ liệu, có thể cần kiểm tra giá trị giữa các cột (VD: trong dữ liệu tiêm chủng có thể có mũi 2 trùng hoặc trước ngày tiêm mũi 1)</p>
<hr>
</section>
</section>
<section id="xử-lý-dữ-liệu" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="xử-lý-dữ-liệu"><span class="header-section-number">4.3.2</span> Xử lý dữ liệu</h3>
<ul>
<li><p>Mã hoá lại dữ liệu/ Xử lý các hàng có giá trị lỗi</p></li>
<li><p>Lọc trùng</p></li>
</ul>
<section id="mã-hoá-dữ-liệu" class="level4" data-number="4.3.2.1">
<h4 data-number="4.3.2.1" class="anchored" data-anchor-id="mã-hoá-dữ-liệu"><span class="header-section-number">4.3.2.1</span> Mã hoá dữ liệu</h4>
<p>Các trường hợp có thể cần mã hoá lại dữ liệu:</p>
<ul>
<li><p>Dữ liệu NA (trống)</p></li>
<li><p>Các dữ liệu dạng TRUE/FALSE được hiển thị bằng cách khác trong dữ liệu gốc (VD: Đánh dấu X hoặc bỏ trống trong file excel)</p></li>
</ul>
<p>Các lệnh liên quan đến mã hoá dữ liệu:</p>
<ul>
<li><p><code>replace_na</code> thay thế giá trị <code>NA</code> bằng giá trị được cung cấp</p></li>
<li><p><code>is.na</code> chuyển thành định dạng logical, các dữ liệu trống (NA) có giá trị TRUE và ngược lại</p></li>
<li><p><code>ifelse</code> mã hoá theo điều kiện đơn giản, chỉ có 2 trường hợp khi đáp ứng điều kiện hoặc không.</p></li>
<li><p><code>case_when</code> mã hóa giá trị cho nhiều trường hợp nhất định</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Thay thế các giá trị NA trong cột col1 thành "default"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col1 =</span> <span class="fu">replace_na</span>(<span class="st">"default"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Thay thế các giá trị được đánh dấu trong col2 thành TRUE và ngược lại</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col2 =</span> <span class="sc">!</span><span class="fu">is.na</span>(col2))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Cách làm khác bằng ifelse</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col2 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(col2), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lọc-trùng" class="level4" data-number="4.3.2.2">
<h4 data-number="4.3.2.2" class="anchored" data-anchor-id="lọc-trùng"><span class="header-section-number">4.3.2.2</span> Lọc trùng</h4>
<p>Lệnh <code>distinct</code> của gói <code>dplyr</code> sẽ dữ lại 1 hàng duy nhất trong các hàng có giá trị bị trùng.</p>
<p>Lệnh <code>distinct</code> mặc định sẽ kiểm tra giá trị của tất cả các cột (2 hàng được đánh giá là trùng khi tất cả các trị của chúng giống nhau).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body" data-line-spacing="2" role="doc-bibliography" style="display: none">
<div id="ref-wickham2014" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Wickham, H. <a href="https://doi.org/10.18637/jss.v059.i10">Tidy Data</a>. <em>Journal of Statistical Software</em> <strong>59</strong>, (2014).</div>
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="thinhong/r4babies" data-repo-id="R_kgDOLQlsRQ" data-category="General" data-category-id="DIC_kwDOLQlsRc4CdLwa" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./r_basics.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Nhập môn R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analysis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân tích</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>